ORG 0000H
LJMP START
ORG 0100H
START:
MAIN:
	;---DN2CH TEST---
	MOV 5BH,#0FFH
	MOV 5AH,#0FDH
	LCALL DBN2CHR
	MOV R2,5FH
	MOV R3,5EH
	MOV R4,5DH
	LJMP $
;-----------------------DN2CH 5BH,5AH中的双字节数转bcd存放在5FH-5DH,使用资源5AH-5FH-----------------------
DBN2CHR:MOV 5FH,#0
	MOV 5EH,#0
	MOV 5DH,#0
	MOV 5CH,#16
DBN2LOP:CLR C	
	MOV A,5AH		;双字节数移位操作
	RLC A
	MOV 5AH,A
	MOV A,5BH
	RLC A
	MOV 5BH,A
	MOV A,5DH
	RLC A
	MOV 5DH,A
	MOV A,5EH
	RLC A
	MOV 5EH,A
	MOV A,5FH
	RLC A
	MOV 5FH,A
	MOV A,5CH
	CJNE A,#1,DBN2JMO 	;最后一次不作调整
	RET
DBN2JMO:CLR C
	MOV A,5DH
	ANL A,#0FH
	SUBB A,#5
	JC DBN2JMA		;当前bcd位值大于4则进行+3调整
	MOV A,5DH
	ADD A,#3
	MOV 5DH,A
DBN2JMA:CLR C
	MOV A,5DH
	ANL A,#0F0H
	SUBB A,#50H
	JC DBN2JMB
	MOV A,5DH
	ADD A,#30H
	MOV 5DH,A
DBN2JMB:CLR C
	MOV A,5EH
	ANL A,#0FH
	SUBB A,#5
	JC DBN2JMC
	MOV A,5EH
	ADD A,#3
	MOV 5EH,A
DBN2JMC:CLR C
	MOV A,5EH
	ANL A,#0F0H
	SUBB A,#50H
	JC DBN2JMD
	MOV A,5EH
	ADD A,#30H
	MOV 5EH,A
DBN2JMD:CLR C
	MOV A,5FH
	ANL A,#0FH
	SUBB A,#5
	JC DBN2JME
	MOV A,5FH
	ADD A,#3
	MOV 5FH,A	
DBN2JME:CLR C
	MOV A,5FH
	ANL A,#0F0H
	SUBB A,#50H
	JC DBN2JMF
	MOV A,5FH
	ADD A,#30H
	MOV 5FH,A
DBN2JMF:DJNZ 5CH,DBN2LOP
	RET

	
END
